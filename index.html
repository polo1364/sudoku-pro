<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sudoku æ•¸ç¨éŠæˆ² Pro+</title>
<style>
body {
  font-family: "Microsoft JhengHei", sans-serif;
  background: #f4f5f7;
  text-align: center;
  padding: 10px;
}
h1 { color: #007bff; margin: 10px 0; }

#board {
  display: grid;
  grid-template-columns: repeat(9, 1fr);
  gap: 0;
  max-width: 360px;
  margin: 10px auto;
  border: 3px solid #333;
}
.cell {
  width: 40px;
  height: 40px;
  text-align: center;
  font-size: 18px;
  border: 1px solid #ccc;
  outline: none;
  background: #fff;
  box-sizing: border-box;
}
.cell:disabled {
  background: #e9ecef;
  font-weight: bold;
  color: #000;
}
.cell[data-row="2"],
.cell[data-row="5"] { border-bottom: 3px solid #333; }
.cell[data-col="2"],
.cell[data-col="5"] { border-right: 3px solid #333; }

#controls { margin: 10px 0; }
button, select {
  margin: 5px;
  padding: 6px 10px;
  font-size: 15px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: #007bff;
  color: #fff;
}
button:hover { background: #0056b3; }

#timer { margin-top: 8px; color: #333; font-weight: bold; }
#message { margin-top: 8px; font-weight: bold; color: #28a745; }
@media (max-width:600px){
  .cell{width:34px;height:34px;font-size:16px;}
  #board{max-width:310px;}
}
</style>
</head>
<body>
<h1>ğŸ§© Sudoku æ•¸ç¨éŠæˆ² Pro+</h1>

<div id="controls">
  <select id="difficulty">
    <option value="easy">ç°¡å–®</option>
    <option value="medium">ä¸­ç­‰</option>
    <option value="hard">å›°é›£</option>
  </select>
  <button onclick="newGame()">æ–°é¡Œç›®</button>
  <button id="hintBtn" onclick="getHint()">ğŸ’¡ æç¤ºï¼ˆ6ï¼‰</button>
  <button onclick="checkBoard()">æª¢æŸ¥</button>
  <button onclick="resetGame()">é‡ç©</button>
</div>

<div id="board"></div>
<div id="timer">æ™‚é–“ï¼š00:00</div>
<div id="message"></div>

<script>
let puzzle=[], solution=[], hintsLeft=6, timerInterval, startTime;
const deepCopy=b=>JSON.parse(JSON.stringify(b));

function isSafe(board,row,col,num){
  for(let i=0;i<9;i++)
    if(board[row][i]===num||board[i][col]===num)return false;
  const sr=Math.floor(row/3)*3,sc=Math.floor(col/3)*3;
  for(let i=0;i<3;i++)
    for(let j=0;j<3;j++)
      if(board[sr+i][sc+j]===num)return false;
  return true;
}
function solve(board){
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      if(board[r][c]===0){
        for(let n=1;n<=9;n++){
          if(isSafe(board,r,c,n)){
            board[r][c]=n;
            if(solve(board))return true;
            board[r][c]=0;
          }
        }
        return false;
      }
    }
  }
  return true;
}

function generateSudoku(difficulty){
  let board=Array.from({length:9},()=>Array(9).fill(0));
  solve(board);
  const solved=deepCopy(board);
  const removeMap={easy:35,medium:45,hard:52};
  let removeCount=removeMap[difficulty]||45;
  let attempts=0;
  while(removeCount>0 && attempts<200){
    attempts++;
    let r=Math.floor(Math.random()*9),c=Math.floor(Math.random()*9);
    if(board[r][c]!==0){
      board[r][c]=0;
      removeCount--;
    }
  }
  return {puzzle:board,solution:solved};
}

function drawBoard(){
  const board=document.getElementById("board");
  board.innerHTML="";
  for(let r=0;r<9;r++){
    for(let c=0;c<9;c++){
      const cell=document.createElement("input");
      cell.className="cell";
      cell.type="text";
      cell.maxLength=1;
      cell.dataset.row=r;cell.dataset.col=c;
      const val=puzzle[r][c];
      if(val!==0){cell.value=val;cell.disabled=true;}
      else{
        const key=`cell_${r}_${c}`;
        const saved=localStorage.getItem(key);
        if(saved)cell.value=saved;
        cell.addEventListener("input",onInput);
      }
      board.appendChild(cell);
    }
  }
}

function onInput(e){
  const cell=e.target;
  const v=cell.value.replace(/[^1-9]/g,"");
  cell.value=v;
  localStorage.setItem(`cell_${cell.dataset.row}_${cell.dataset.col}`,v);
  if(v && v!=solution[cell.dataset.row][cell.dataset.col])
    cell.style.background="#f8d7da";
  else cell.style.background="white";
}

function getCell(r,c){
  return document.querySelector(`.cell[data-row='${r}'][data-col='${c}']`);
}

function updateHintButton(){
  document.getElementById("hintBtn").textContent = `ğŸ’¡ æç¤ºï¼ˆ${hintsLeft}ï¼‰`;
}

function getHint(){
  if(hintsLeft<=0){alert("æç¤ºæ¬¡æ•¸å·²ç”¨å®Œ");return;}
  let empties=[];
  for(let r=0;r<9;r++)for(let c=0;c<9;c++){
    const input=getCell(r,c);
    if(!input.disabled && input.value==="")empties.push({r,c});
  }
  if(empties.length===0){alert("æ²’æœ‰å¯æç¤ºçš„ç©ºæ ¼ï¼");return;}
  const pick=empties[Math.floor(Math.random()*empties.length)];
  const cell=getCell(pick.r,pick.c);
  cell.value=solution[pick.r][pick.c];
  cell.style.background="#fff3cd";
  hintsLeft--;
  updateHintButton();
  document.getElementById("message").textContent = `ğŸ’¡ å‰©é¤˜æç¤ºæ¬¡æ•¸ï¼š${hintsLeft}`;
}

function checkBoard(){
  let correct=true;
  document.querySelectorAll(".cell").forEach(cell=>{
    const r=cell.dataset.row,c=cell.dataset.col;
    if(!cell.disabled){
      if(Number(cell.value)!==solution[r][c]){correct=false;cell.style.background="#f8d7da";}
      else cell.style.background="#d4edda";
    }
  });
  const msg=document.getElementById("message");
  msg.textContent=correct?"ğŸ‰ å®Œæˆï¼":"âŒ å°šæœªæ­£ç¢º";
  if(correct){clearInterval(timerInterval);localStorage.clear();}
}

function resetGame(){
  hintsLeft = 6;
  updateHintButton();
  document.querySelectorAll(".cell").forEach(cell=>{
    if(!cell.disabled){
      cell.value="";
      cell.style.background="white";
      localStorage.removeItem(`cell_${cell.dataset.row}_${cell.dataset.col}`);
    }
  });
  startTimer();
  document.getElementById("message").textContent="ğŸ’¡ æç¤ºæ¬¡æ•¸å·²é‡ç½®ç‚º 6 æ¬¡";
}

function newGame(){
  const diff=document.getElementById("difficulty").value;
  const data=generateSudoku(diff);
  puzzle=data.puzzle;solution=data.solution;
  localStorage.clear();
  hintsLeft = 6;
  drawBoard();
  updateHintButton();
  startTimer();
  document.getElementById("message").textContent=`æ–°é¡Œç›®ï¼ˆ${diff}ï¼‰å·²ç”Ÿæˆï¼ˆğŸ’¡ å¯ç”¨æç¤ºï¼š6æ¬¡ï¼‰`;
}

function startTimer(){
  clearInterval(timerInterval);
  startTime=Date.now();
  timerInterval=setInterval(()=>{
    const elapsed=Math.floor((Date.now()-startTime)/1000);
    const m=String(Math.floor(elapsed/60)).padStart(2,"0");
    const s=String(elapsed%60).padStart(2,"0");
    document.getElementById("timer").textContent=`æ™‚é–“ï¼š${m}:${s}`;
  },1000);
}
newGame();
</script>
</body>
</html>